# Nginx tools routing configuration
# Routes tool requests to appropriate containers

upstream chromadb_backend {
    server chromadb:8000;
}

upstream redis_backend {
    server redis:6379;
}

server {
    listen 80;
    server_name localhost;

    # Health check endpoint
    location /health {
        return 200 '{"status": "healthy", "service": "tool-proxy"}';
        add_header Content-Type application/json;
    }

    # ChromaDB vector database
    location /api/chromadb/ {
        limit_req zone=api burst=20 nodelay;
        proxy_pass http://chromadb_backend/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_connect_timeout 30s;
        proxy_read_timeout 60s;
    }

    # Tool execution status
    location /api/tools/status {
        return 200 '{"sandbox": "available", "security": "available", "web": "available", "nodejs": "available", "chromadb": "available", "redis": "available"}';
        add_header Content-Type application/json;
    }

    # Container info
    location /api/containers {
        return 200 '{"containers": ["sandbox", "security", "web", "nodejs", "chromadb", "redis"]}';
        add_header Content-Type application/json;
    }

    # Default - return 404 for unknown routes
    location / {
        return 404 '{"error": "Not found", "message": "Use /api/tools/status to check available tools"}';
        add_header Content-Type application/json;
    }
}
